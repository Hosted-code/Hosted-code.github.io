---
title: 【随笔】一次排查种族敏感词的操作
tags:
  - 随笔
  - 办公软件
  - shell
categories:
  - 随笔
date: 2020-07-16 21:32:23
---

> **伴随着愈演愈烈的“Black Lives Matter”运动，Linus Torvalds 本周五批准在 Linux 内核代码和文档中启用全新的术语，以让整个生态更具包容性。**而且，Torvalds 还呼吁 Linux 开发者尽量使用新术语来替代“master/slave”、“blacklist/whitelist”。



基于近期的运动, 公司也要求在代码, 资料, ui上排查**种族敏感词汇**, 包括 master, slave, blacklist, whitelist

排查代码中的敏感词汇, `grep` 命令即可搞定, 然后需要输出文档, 用以做评估工作量的参考

![grep](https://cdn.jsdelivr.net/gh/Hosted-code/CloudImg@master/20200719123206.png)



<!-- more -->

# grep

```bash
grep -inR --exclude-dir=.git whitelist
```

**grep option**, 非所有选项, 仅列出常用的, 完整查看`man grep`

- 匹配模式
  - ``-E`, extend regexp, 扩展正则, `egrep`, （支持 `?`、`+`、`{}`、`()`、`|`）
  - `-i`, ignore case, 忽略大小写
  - `-w`, word,  匹配整个单词
  - `-l`, line, 匹配整行
  - `-v`, invert match,  匹配反选, 显示不匹配的行
  - `-q`, quiet, 不输出, **一般用于条件测试**, 成功为 0, 失败为非 0
- grep范围
  - action, 动作
    -  `read`, 默认action, 读取
    - `skip`,  跳过, 忽略
    - `recurse`, 递归,  等同于 `-r`
    - `-D action`, 针对device 采取action
    - `-d device`, 针对 directory 采取action
  - 指定查找范围, **通配符**
    - `--include`, 只在指定范围内搜索,  `grep "whitelist" . -r --include *.{h,c}`
    - `--exclude`, 搜索时排除文件
    - `--exclude-from`,  根据指定文件内容排除对应文件, `grep "whitelist" . -r --exclude-from filelist`
    - `--exclude-dir`, 搜索时排除指定目录, `-d skip` 是遇到任何目录都会跳过, `--exclude-dir` 只会跳过特定目录. 实测 `--exclude` 并不能排除目录
    - `-r`, recurse, 递归查找, 当前目录文件及子目录下的文件均要查找, 
    - `-R`, 等同于 `-r`, 区别是, **`-R`会追踪符号链接**
- 输出控制
  - `-c`, count, 不显示具体匹配, 只显示每个文件匹配数, 配合`-v`, 则为不匹配数
  - `--color=auto`,  颜色控制
  - `-L`/`-l`,  匹配多个文件时, 显示 **不匹配/匹配** 的文件名
  - `-m`, max count, 控制匹配的最大数
  - `-n`, line number, 输出匹配行数
  - 上下文控制, 匹配行附近的内容
    - `-A num`,  after context, 显示匹配行之后 num 行
    - `-B num`, before context , 显示匹配行之前 num 行
    - `-C num`,  context, 显示匹配行前后 num 行, 直接 `-num` 也是一样的效果
- `-a, --text`,  以文本方式搜索
  - 搜索.c, .h文件是出现 **binary file match**
  - 原因是文件内容中出现 `\000` 时, `grep` 会将该文件认作二进制文件
  - 使用 `-a`, 将**误认为的二进制文件**以文本文件搜索
  - **不能滥用**, 若将真正的二进制文件以文本方式搜索, 会导致整个**终端乱码**, 只有断开重连才会恢复

# 输出文档

- 将 `grep` 查找结果输出到excel中, 使用数据透视表统计
  - `grep -c` 可做统计, 但没有查找结果
- **数据分列,** 将数据分成多列, **文件, 行数, 代码**
- **提取关键词**, `grep` 搜索是多个条件是多个条件同时搜索的, 无法根据敏感词分别做统计, 需要在搜索结果中**提取关键词**
  - 新建一列, 为**关键词**列
  - 在某处列出关键词, 如 `H3:H6`
  - 输入公式, `=lookup(,-search($H$3:$H$6, $D2), $H$3:$H$6)`
    - 假定搜索结果在D列
    - `search` 忽略大小写查找
    - `=lookup(lookup_value, lookup_vector, result_vector)`
- **数据透视表**, 关键词, 文件拖到**行**, 代码拖到**值**, 值为计数项



# 参考链接

[Linus Torvalds批准启用新术语替代master/slave、blacklist/whitelist ](https://www.sohu.com/a/407125383_99956743)

[grep命令_Linux grep 命令用法详解：强大的文本搜索工具](https://man.linuxde.net/grep)

[grep linux 命令 在线中文手册](http://linux.51yip.com/search/grep)